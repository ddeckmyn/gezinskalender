<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gezinskalender</title>

  <link rel="manifest" href="/manifest.webmanifest">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Gezinskalender</h1>

  <h2>Gezinsleden</h2>
  <ul id="members"></ul>

  <h2>Activiteiten</h2>
  <ul id="activities"></ul>
  <h3>Nieuwe activiteit</h3>

<form id="activity-form">
  <label>
    Wie:
    <select id="member-select"></select>
  </label>
  <br><br>

  <label>
    Titel:
    <input type="text" id="title-input" />
  </label>
  <br><br>

  <label>
    Start:
    <input type="datetime-local" id="start-input" />
  </label>
  <br><br>

  <label>
    Eind:
    <input type="datetime-local" id="end-input" />
  </label>
  <br><br>

  <button type="submit">Toevoegen</button>
</form>


  <p><a href="/tv.html">TV-modus</a></p>

  <script>
    const SUPABASE_URL = "https://jcwxkicgbctylbdlsbcm.supabase.co";
    const SUPABASE_KEY = "sb_publishable_tF7MRrXQu6x3aBtdvLwmhA_FY4A8Eu3";

    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadMembers() {
      const { data, error } = await sb.from("members").select("name, role");
      if (error) return;

      const ul = document.getElementById("members");
      ul.innerHTML = "";
      data.forEach(m => {
        const li = document.createElement("li");
        li.textContent = `${m.name} (${m.role})`;
        ul.appendChild(li);
      });
    }

    async function loadActivities() {
      const { data, error } = await sb
        .from("activities")
        .select(`
          title,
          location,
          start_at,
          end_at,
          members ( name )
        `);

      if (error) return;

      const ul = document.getElementById("activities");
      ul.innerHTML = "";
      data.forEach(a => {
        const li = document.createElement("li");
        const start = new Date(a.start_at).toLocaleString();
        const who = a.members?.name ?? "Onbekend";
        li.textContent = `${who} â€” ${a.title}${a.location ? " (" + a.location + ")" : ""} om ${start}`;
        ul.appendChild(li);
      });
    }
async function fillMemberSelect() {
  const { data, error } = await sb.from("members").select("id, name").order("name");
  if (error) return;

  const sel = document.getElementById("member-select");
  sel.innerHTML = "";
  data.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m.id;
    opt.textContent = m.name;
    sel.appendChild(opt);
  });
}
fillMemberSelect();
loadMembers();
loadActivities();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js");
    }
  </script>
</body>
</html>
